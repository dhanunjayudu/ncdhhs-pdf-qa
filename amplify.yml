version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - cd frontend
            - echo "=== Environment Information ==="
            - node --version
            - npm --version
            - echo "=== Installing Dependencies ==="
            - npm ci
            - echo "=== Dependencies Installed Successfully ==="
            - echo "=== Setting Build Environment ==="
            - export DISABLE_ESLINT_PLUGIN=true
            - export ESLint_NO_DEV_ERRORS=true
            - export CI=false
            - echo "=== Environment Variables Set ==="
        build:
          commands:
            - echo "=== Starting React Build ==="
            - npm run build
            - echo "=== Build Completed ==="
            - echo "=== Verifying Build Output ==="
            - ls -la build/
            - test -f build/index.html || (echo "❌ ERROR: index.html missing" && exit 1)
            - test -d build/static || (echo "❌ ERROR: static directory missing" && exit 1)
            - echo "✅ Build verification passed"
        postBuild:
          commands:
            - echo "=== Post-Build Verification ==="
            - find build/ -name "*.js" | head -3
            - find build/ -name "*.css" | head -3
            - echo "=== Deployment Ready ==="
      artifacts:
        baseDirectory: frontend/build
        files:
          - '**/*'
      cache:
        paths:
          - frontend/node_modules/**/*
    appRoot: frontend
    customHeaders:
      - pattern: '**/*'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=31536000'
      - pattern: '/index.html'
        headers:
          - key: 'Cache-Control'
            value: 'no-cache, no-store, must-revalidate'
      - pattern: '/service-worker.js'
        headers:
          - key: 'Cache-Control'
            value: 'no-cache, no-store, must-revalidate'
